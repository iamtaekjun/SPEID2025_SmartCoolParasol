# 보조배터리 + 릴레이 + 워터펌프 안전 연결 가이드

## 🔌 전원 연결 순서 (매우 중요!)

### ⚠️ 기본 원칙: "전원은 항상 마지막에!"

## 1단계: 사전 준비
```
✅ 필요 부품 준비
   - 아두이노 UNO
   - 5V 릴레이 모듈 (1채널)
   - DC 5V 워터펌프
   - 보조배터리
   - 피복 벗긴 USB 케이블 (빨강, 검정선만)
   - 브레드보드
   - 점퍼 와이어

✅ 작업 환경 준비
   - 깨끗하고 건조한 작업대
   - 충분한 조명
   - 멀티미터 (전압 확인용)
```

## 2단계: 전원 없이 신호선만 연결

### 🔹 아두이노 ↔ 릴레이 신호선 연결
```
Arduino UNO          릴레이 모듈
D6 핀 ──────────── IN 핀 (제어 신호선)

⚠️ 이때는 전원선(VCC, GND) 연결하지 말 것!
```

### 🔹 릴레이 ↔ 워터펌프 연결 (전원 제외)
```
릴레이 모듈          워터펌프
NO 단자 ──────── + (빨간선)

⚠️ 이때는 펌프 - (검정선) 연결하지 말 것!
```

## 3단계: 브레드보드 전원 버스 구성

### 🔹 브레드보드 준비
```
브레드보드
┌─────────────────────────────────┐
│ + + + + + (빨간 레일) +5V Bus   │
│                                 │  
│ - - - - - (파란 레일) GND Bus   │
└─────────────────────────────────┘

⚠️ 아직 보조배터리 연결하지 말 것!
```

## 4단계: GND 라인 연결 (전원 투입 전)

### 🔹 모든 GND를 브레드보드 GND Bus에 연결
```
GND Bus (브레드보드 파란 레일)
├── Arduino GND 핀
├── 릴레이 모듈 GND 핀  
└── 워터펌프 - (검정선)

⚠️ 보조배터리 검정선은 아직 연결하지 말 것!
```

## 5단계: +5V 라인 연결 (전원 투입 전)

### 🔹 모든 +5V를 브레드보드 +5V Bus에 연결
```
+5V Bus (브레드보드 빨간 레일)
├── Arduino 5V 핀
├── 릴레이 모듈 VCC 핀
└── 릴레이 모듈 COM 단자

⚠️ 보조배터리 빨간선은 아직 연결하지 말 것!
```

## 6단계: 최종 점검 (전원 투입 전)

### 🔍 연결 상태 재확인
```
✅ 신호선 연결 확인
   Arduino D6 → 릴레이 IN ✓

✅ 스위칭 회로 확인  
   릴레이 COM → +5V Bus ✓
   릴레이 NO → 워터펌프 + ✓

✅ GND 공통화 확인
   모든 부품 GND → GND Bus ✓

✅ 전원 분배 확인
   모든 부품 VCC → +5V Bus ✓

✅ 단락 방지 확인
   빨간선과 검정선 접촉 없음 ✓
```

## 7단계: 전원 투입 (단계별)

### 🔹 1차: GND 연결
```
보조배터리 검은선 → 브레드보드 GND Bus
→ 멀티미터로 전압 확인 (0V 여야 함)
```

### 🔹 2차: +5V 연결 (최종)
```
보조배터리 빨간선 → 브레드보드 +5V Bus
→ 멀티미터로 전압 확인 (5V ± 0.25V)
```

### 🔹 3차: 동작 확인
```
1. 아두이노 전원 LED 켜짐 확인
2. 보조배터리 출력 표시 확인  
3. 과열이나 스파크 없음 확인
```

## 8단계: 테스트 코드 실행

### 🔹 코드 업로드 준비
```
1. 테스트 코드 (circuit_test.cpp)를 src/main.cpp로 복사
2. PlatformIO로 업로드
3. 시리얼 모니터 열기 (9600 baud)
```

### 🔹 자동 테스트 진행
```
1단계: 전원 공급 확인 (LED 깜빡임)
2단계: 릴레이 기능 테스트 (딸깍 소리)  
3단계: 워터펌프 안전성 테스트 (1초 동작)
4단계: 워터펌프 동작 테스트 (5초 연속)
5단계: 내구성 테스트 (간헐 동작 5회)
```

## 🚨 긴급상황 대응

### 즉시 전원 차단이 필요한 상황
```
❌ 스파크나 연기 발생
❌ 과도한 발열 (만지기 어려울 정도)
❌ 비정상적인 소음 (삐걱, 윙윙 등)
❌ 펌프가 전혀 동작하지 않음
❌ 아두이노 리셋 반복
```

### 긴급정지 방법
```
1. 즉시 's' 키 입력 (소프트웨어 정지)
2. 보조배터리 연결 해제 (하드웨어 정지)
3. 회로 점검 후 재시도
```

## 💡 성공 확인 체크리스트

### 정상 동작 신호
```
✅ 아두이노 전원 LED 지속적으로 켜짐
✅ 릴레이에서 명확한 딸깍 소리 (ON/OFF 시)
✅ 워터펌프에서 물 분사 또는 소음
✅ 과열 없음 (손으로 만져서 따뜻한 정도)
✅ 보조배터리 정상 출력 표시
```

## 📋 트러블슈팅

### 문제 상황별 대응
```
🔸 아두이노 전원 LED 안 켜짐
   → 보조배터리 전압 확인 (5V)
   → +5V Bus 연결 확인

🔸 릴레이 소리 안 들림  
   → Arduino D6 ↔ 릴레이 IN 연결 확인
   → 릴레이 모듈 VCC/GND 연결 확인

🔸 워터펌프 동작 안 함
   → 릴레이 COM ↔ +5V Bus 연결 확인
   → 릴레이 NO ↔ 펌프 + 연결 확인
   → 펌프 - ↔ GND Bus 연결 확인

🔸 과전류/과열 발생
   → 즉시 전원 차단
   → 워터펌프 사양 재확인 (2A 이하?)
   → 보조배터리 출력 용량 확인
```

이 순서대로 연결하면 **안전하고 확실하게** 회로를 구성할 수 있습니다!